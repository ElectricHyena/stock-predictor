# Database Migrations

This directory contains Alembic database migration files for StockPredictor backend.

## Structure

- `alembic.ini` - Alembic configuration file
- `env.py` - Migration environment configuration (integrated with SQLAlchemy)
- `script.py.mako` - Migration script template
- `versions/` - Individual migration files

## Usage

### Create a new migration (manual)
```bash
alembic revision -m "Description of changes"
```

### Create a migration (autogenerate - requires database connection)
```bash
alembic revision --autogenerate -m "Description of changes"
```

### Apply migrations to database
```bash
alembic upgrade head
```

### Rollback to previous migration
```bash
alembic downgrade -1
```

### Check current migration status
```bash
alembic current
```

### View migration history
```bash
alembic history
```

## Database Schema

The initial migration (`322ea9eccb10_initial_migration_create_all_tables.py`) creates:

1. **stocks** - Master stock table
2. **stock_prices** - Historical OHLCV price data
3. **news_events** - News articles and events
4. **event_price_correlations** - Historical event-price correlations
5. **predictability_scores** - Computed predictability metrics

All tables include proper indices, foreign keys, and constraints for optimal performance and data integrity.

## Configuration

The env.py is configured to:
- Auto-load database URL from `app.config.settings.DATABASE_URL`
- Detect changes in SQLAlchemy models automatically
- Support both online (connected) and offline (SQL generation) modes

## Important Notes

- Migrations are managed through Alembic, not through SQLAlchemy's `Base.metadata.create_all()`
- Always review generated migrations before applying to production
- Keep migration scripts in version control
- Test migrations on a copy of your database before applying to production
